<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>首页</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="css/commit.css" />
		<link rel="stylesheet" type="text/css" href="css/home.css"/>
		<link rel="stylesheet" href="css/iconfont.css" />
		<script src="js/pixel.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<body>
		<header class="mui-header" class="mui-bar mui-bar-nav">
			<div class="mui-mleft">
				<a class="mui-link" href='home-classify.html'>
					<i class="mui-hicon mui-hicon-menu"></i> <br>
					<span id="mui-lei">
						分类
					</span>
				</a>
			</div>
		    <div id="search" class="mui-input-row mui-search">
		        <input type="search" disabled class="mui-input-clear" placeholder="请输入关键词">
		    </div>
		    <div class="mui-mright">
		    	<a class="mui-hicon mui-hicon-sweep"></a><a href="home-message.html" class="mui-link mui-hicon mui-hicon-message"></a>
		    </div>
		</header>
		<div class="mui-content mui-home">
		    <div id="slider" class="mui-slider mui-fullscreen">
		        <div class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
		            <a class="mui-control-item mui-active" href="#item1">
		            	<div class="warpper-icon"><img src="img/icon-tong.png" height="55"/></div> 
		            	<span class="tab-text">
		            		自贸区
		            	</span>
		            </a>
		            <a class="mui-control-item" href="#item2">
		            	<div class="warpper-icon"><image src="img/icon-tian.png" height="55"/></div>
		            	<span class="tab-text">
		            		特卖区
		            	</span>
		            </a>
		            <a class="mui-control-item" href="#item3">
		            	<div class="warpper-icon"><img src="img/icon-shang.png" height="55"/></div>
		            	<span class="tab-text">
		            		0元购
		            	</span>
		            </a>
		            <a class="mui-control-item" href="#item4">
		            	<div class="warpper-icon"><img src="img/iocn-pin.png" height="55"/></div>
		            	<span class="tab-text">
		            		抽奖区
		            	</span>
		            </a>
		        </div>
		       
		        <div class="mui-slider-group">
		            <div id="item1" class="mui-slider-item mui-control-content mui-active">
		            	<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
				                <ul class="mui-table-view">
				                    <li class="mui-table-view-cell" data-url="home-details.html">
				                    	<image src="img/33.png"/>
				                    	<div class="mui-htitle">
				                    		<div class="mui-left">
				                    			VindKan新品
				                    		</div>
				                    		<div class="mui-right mui-share">
				                    			<!--分享 <i class="mui-icon iconfont icon-fenxiang"></i>-->
				                    			分享 <i class="mui-hicon mui-hicon-share"></i>
				                    		</div>
				                    	</div>
				                    	<div class="mui-countdown" style="color: #000000;">
				                    		<div class="mui-hbar">
				                    			<div class="mui-hbar-value" style="width: 50%;">
				                    				
				                    			</div>
				                    		</div>  &nbsp; 即将售罄
				                    	</div>
				                    	<div class="mui-price">
				                    		￥258.00
				                    		<div class="mui-fright">
				                    			<button type="button" class="mui-btn mui-btn-red">马上抢</button>
				                    		</div>
				                    	</div>
				                    	<div class="mui-shop"><img src="img/6.png"/>通天自营</div>
				                    </li>
				                    <li class="mui-table-view-cell"  data-url="home-details.html">
				                    	<image src="img/pic.png"/>
				                    	<div class="mui-htitle">
				                    		<div class="mui-left">
				                    			VindKan新品英
				                    		</div>
				                    		<div class="mui-right mui-share">
				                    			分享 <i class="mui-hicon mui-hicon-share"></i>
				                    		</div>
				                    	</div>
				                    	<div class="mui-countdown" style="color: #000000;">
				                    		自贸区
				                    	</div>
				                    	<div class="mui-price">
				                    		￥258.00
				                    		<div class="mui-fright">
				                    			<button type="button" class="mui-btn mui-btn-red">马上抢</button>
				                    		</div>
				                    		<div class="mui-shop"><img src="img/6.png"/>通天自营</div>
				                    	</div>
				                    </li>
				                </ul>
				            </div>
				        </div>
		            </div>
		            <div id="item2" class="mui-slider-item mui-control-content">
		            	<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
				                <ul class="mui-table-view">
				                    <li class="mui-table-view-cell">
				                    	<image src="img/pic.png"/>
				                    	<div class="mui-htitle">
				                    		<div class="mui-left">
				                    			瓷器-中国老瓷器系列
				                    		</div>
				                    		<div class="mui-right mui-share">
				                    			分享 <i class="mui-hicon mui-hicon-share"></i>
				                    		</div>
				                    	</div>
				                    	<div class="mui-countdown">
				                    		<div class="mui-hbar">
				                    			<div class="mui-hbar-value" style="width: 50%;">
				                    				
				                    			</div>
				                    		</div>
				                    		<span class="mui-text">
				                    			剩余10件
				                    		</span>
				                    		<div class="mui-fright mui-time" data-end-time="2019-02-10 11:00:01">
				                    			剩余1 天   02:11:35
				                    		</div>
				                    	</div>
				                    	<div class="mui-price">
				                    		￥233.00-400.00
				                    		<div class="mui-fright">
				                    			<button type="button" class="mui-btn mui-btn-red">马上抢</button>
				                    		</div>
				                    	</div>
				                    	<div class="mui-shop"><img src="img/6.png"/>通天自营</div>
				                    </li>
				                    <li class="mui-table-view-cell">
				                    	<div class="mui-image-warpper">
				                    		<image src="img/pic.png"/>
				                    		<div class="mui-complete">
				                    			已售罄
				                    		</div>
				                    	</div>
				                    	<div class="mui-htitle">
				                    		<div class="mui-left">
				                    			瓷器-中国老瓷器系列
				                    		</div>
				                    		<div class="mui-right mui-share">
				                    			分享 <i class="mui-hicon mui-hicon-share"></i>
				                    		</div>
				                    	</div>
				                    	<div class="mui-countdown">
				                    		<div class="mui-hbar">
				                    			<div class="mui-hbar-value" style="width: 100%;">
				                    				100%
				                    			</div>
				                    		</div>
				                    		<span class="mui-text">
				                    			已抢完
				                    		</span>
				                    		<div class="mui-fright mui-time mui-gray">
				                    			已结束   00:00:00
				                    		</div>
				                    	</div>
				                    	<div class="mui-price">
				                    		￥233.00-400.00
				                    		<div class="mui-fright">
				                    			<button type="button" disabled class="mui-btn mui-btn-red">马上抢</button>
				                    		</div>
				                    	</div>
				                    	<div class="mui-shop"><img src="img/6.png"/>通天自营</div>
				                    </li>
				                </ul>
		                	</div>
		               	</div>
		            </div>
		            <div id="item3" class="mui-slider-item mui-control-content">
		            	<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
				                <ul class="mui-table-view">
				                    <li class="mui-table-view-cell" data-url="details.html">
										<image src="img/pic.png"/>
										<div class="mui-htitle">
											<div class="mui-left">
												VindKan新品英新
											</div>
											<div class="mui-right mui-share">
				                    			分享 <i class="mui-hicon mui-hicon-share"></i>
				                    		</div>
										</div>
										<div class="mui-countdown" style="color: #000000;">
											<!--<i class="mui-line"></i> 即将售罄-->
											<div class="mui-hbar">
				                    			<div class="mui-hbar-value" style="width: 50%;">
				                    				
				                    			</div>
				                    		</div>  &nbsp; 即将售罄
										</div>
										<div class="mui-price">
											￥0 <span class="del">原价24</span>
											<div class="mui-fright">
												<button type="button" class="mui-btn mui-btn-red">马上抢</button>
											</div>
										</div>
										<div class="mui-shop"><img src="img/6.png"/>通天自营</div>
									</li>
				                </ul>
				           	</div>
		            	</div>				           
		            </div>
		        </div>
		    </div>
		</div>
	    <nav class="mui-bar mui-bar-tab">
			<a id="defaultTab" class="mui-tab-item mui-active">
			    <span class="mui-icon iconfont icon-shouye"></span>
			    <span class="mui-tab-label">首页</span>
			</a>
			<a class="mui-tab-item mui-link" href="brand.html">
			    <span class="mui-icon iconfont icon-pinpaiguanli"></span>
			    <span class="mui-tab-label">品牌区</span>
			</a>
			<a class="mui-tab-item mui-link" href="shoppingCart.html">
			    <span class="mui-icon iconfont icon-ERP_gouwuche"></span>
			    <span class="mui-tab-label">购物车</span>
			</a>
			<a class="mui-tab-item mui-link" href="my.html">
			    <span class="mui-icon iconfont icon-wode"></span>
			    <span class="mui-tab-label">我的</span>
			</a>
		</nav>
		<script src="js/mui.min.js"></script>
		<script src="js/mui.pullToRefresh.js"></script>
		<script src="js/mui.pullToRefresh.material.js"></script>
		<script src="js/home.js"></script>
		<script>
			mui.init();
			(function($) {
				var deceleration = mui.os.ios ? 0.003 : 0.0009;
				var tabData = [
					{totalPage: 2, pageNum: 1}, // 自贸区
					{totalPage: 1, pageNum: 1}, // 特卖区
					{totalPage: 1, pageNum: 1}, // 0元购
				];
				var tabIndex = 0; // tab索引
				var data1 = [ // 自贸区模拟数据
					{id: 0, pic: 'img/pic.png', title: '瓷器-中国老瓷器系列1', price: 22.00},
					{id: 1, pic: 'img/pic.png', title: '瓷器-中国老瓷器系列2', price: 22.00}
				];
				var data2 = [ // 特卖区模拟数据
					{id: 0, pic: 'img/pic.png', title: '瓷器-中国老瓷器系列1', ratio: 50, num: 2, price: '22.00-33.00'},
					{id: 1, pic: 'img/pic.png', title: '瓷器-中国老瓷器系列2', ratio: 80, num: 3, price: '22.00-33.00'}
				];
				var addHandler = function () {
					$('body').on('tap','.mui-table-view-cell', function(e) {
						var url = this.getAttribute('data-url');
						if (url) {
							window.location.href = url;
						}
					});
					$('body').on('tap', '.mui-btn', function (e) {
						e.stopPropagation();
						console.log(e.target, '马上');
						window.location.href = 'home-details.html';
					});
					$('body').on('tap', '.mui-link', function () { // 解决a标签点击无效
						if (this.href) {
							window.location.href = this.href;
						}
					})
				};
				var removeHanlder = function () {
					$('body').off('tap');
				};
				
				
				$('.mui-scroll-wrapper').scroll({
					bounce: false,
					indicators: true, //是否显示滚动条
					deceleration:deceleration
				});
				$.ready(function() {
					addHandler();
					document.getElementById('search').addEventListener('click', function () {
						console.log('aadd');
						window.location.href = 'home-search.html';
					});
					/* 监听tab切换 */
					document.getElementById('slider').addEventListener('slide', function(e) {
						console.log(e.detail.slideNumber);
						tabIndex = e.detail.slideNumber
					});
					var slider = document.querySelector('.mui-slider-group');
					var siderIndicator = document.querySelector('.mui-home .mui-slider-indicator');
					$.each(document.querySelectorAll('.mui-scroll-wrapper' ), function() {
						this.addEventListener('scroll', function (e) {
							
						    if (e.detail.y < 0) {
						    	siderIndicator.style.top = '-0.8108108108108109rem';
						    	slider.style.top = '2.2432432432432434rem';
						    	slider.style.transitionDuration = '0.3s';
						    } else {
						    	console.log('sss');
						    	siderIndicator.style.top = '1.0810810810810811rem';
						    	slider.style.top = '4.135135135135135rem ';
						    	slider.style.transitionDuration = '0.3s';
						    }
						});
					});

					/* 遍历tab下面的内容 */
					$.each(document.querySelectorAll('.mui-slider-group .mui-scroll'), function(index, pullRefreshEl) {
//						mui("#pullrefresh").pullRefresh().setStopped(true)
						$(pullRefreshEl).pullToRefresh({
							down: {
								callback: function() { // 下拉刷新回调
									console.log(index, '  down')
//									var ul = this.element.querySelector('.mui-table-view');
//									ul.innerHTML = '';
									this.endPullDownToRefresh();
									siderIndicator.style.top = '1.0810810810810811rem';
							    	slider.style.top = '4.135135135135135rem ';
							    	slider.style.transitionDuration = '0.3s';
								}
							},
							up: {
								callback: function() { // 上拉加载回调
									var self = this;
									siderIndicator.style.top = '-0.8108108108108109rem';
							    	slider.style.top = '2.2432432432432434rem';
							    	slider.style.transitionDuration = '0.3s';
									setTimeout(function() {
										var ul = self.element.querySelector('.mui-table-view');
										var elementNode;
										tabData[tabIndex].pageNum++;
										switch (tabIndex){
											case 0:
												elementNode = createSelfTradeHtml(data1);
												break;
											case 1:
												elementNode = createSpecialSaleHtml(data2);
												break;
											case 2:
												elementNode = createGratisHtml(data1);
												break;
											default:
												break;
										}
										ul.appendChild(elementNode);
										removeHanlder();
										addHandler();
										var isFinish = tabData[tabIndex].pageNum >= tabData[tabIndex].totalPage;
//										console.log(isFinish, '  page ', tabData[tabIndex].pageNum, tabData[tabIndex].totalPage);
										self.endPullUpToRefresh(isFinish);
									}, 1000);
								}
							}
						});
					});
					$('.mui-time').each(function () {
						changeTimerText(this)
					})



				})
			})(mui);
			
			/* 创建自贸区html */
			var createSelfTradeHtml = function (data) {
				console.log(data);
				var fragment = document.createDocumentFragment();
				var li;
				for (var i = 0; i < data.length; i++) {
					li = document.createElement('li');
					li.className = 'mui-table-view-cell';
//						li.innerHTML = '<li class="mui-table-view-cell"><image src="images/pic.png"/></li>';
					
					li.innerHTML = `
							<image src="${data[i].pic}"/>
		                	<div class="mui-htitle">
		                		<div class="mui-left">
		                			${data[i].title}
		                		</div>
		                		<div class="mui-right mui-share">
		                			分享 <i class="mui-hicon mui-hicon-share"></i>
		                		</div>
		                	</div>
		                	<div class="mui-countdown" style="color: #000000;">
		                		<i class="mui-line"></i> 即将售罄
		                	</div>
		                	<div class="mui-price">
		                		￥${data[i].price}
		                		<div class="mui-fright">
				        			<button type="button" class="mui-btn mui-btn-red">马上抢</button>
				        		</div>
							</div>
							<div class="mui-shop"><img src="img/6.png"/>通天自营</div>`;
											
		            fragment.appendChild(li);
               }
				return fragment;
			};
			
			/* 创建特卖区html */
			var createSpecialSaleHtml = function (data) {
				var fragment = document.createDocumentFragment();
				var li;
				for (var i = 0; i < data.length; i++) {
					li = document.createElement('li');
					li.className = 'mui-table-view-cell';
					li.setAttribute('data-url', 'home-details.html')
					li.innerHTML = `<image src="${data[i].pic}"/>
										<div class="mui-htitle">
											<div class="mui-left">
												${data[i].title}
											</div>
											<div class="mui-right mui-share">
				                    			分享 <i class="mui-hicon mui-hicon-share"></i>
				                    		</div>
										</div>
										<div class="mui-countdown">
											<div class="mui-hbar">
												<div class="mui-hbar-value" style="width: ${data[i].ratio}%;">
													${data[i].ratio}%
												</div>
											</div>
											<span class="mui-text">
												剩余${data[i].num}件
											</span>
											<div class="mui-fright mui-time" data-end-time="2019-01-10 11:00:01">
												剩余1 天   02:11:35
											</div>
										</div>
										<div class="mui-price">
											￥233.00-400.00
											<div class="mui-fright">
												<button type="button" class="mui-btn mui-btn-red">马上抢</button>
											</div>
										</div>
										<div class="mui-shop"><img src="img/6.png"/>通天自营</div>`;
					fragment.appendChild(li);
					changeTimerText(li.querySelector('.mui-time'))
				}
				return fragment;
			}
			/* 倒计时显示 */
			var changeTimerText = function (el) {
					if (!el) return;
					var time = el.getAttribute('data-end-time')
					console.log(time)
					if (time) {
						setInterval(function () {
							el.innerText = countTime(new Date(), new Date(time.replace(/-/g,'/')));
						}, 1000)
					}
				}
			/* 0元购html */
			var createGratisHtml = function (data) {
				var fragment = document.createDocumentFragment();
				var li;
				for (var i = 0; i < data.length; i++) {
					li = document.createElement('li');
					li.className = 'mui-table-view-cell';
					li.innerHTML = `
		                	<image src="${data[i].pic}"/>
		                	<div class="mui-htitle">
		                		<div class="left">
		                			${data[i].title}
		                		</div>
		                		<div class="mui-right share">
		                			分享 <i class="icon icon-share"></i>
		                		</div>
		                	</div>
		                	<div class="mui-countdown" style="color: #000000;">
		                		<i class="mui-line"></i> 即将售罄
		                	</div>
		                	<div class="mui-price">
													￥0 <span class="del">原价${data[i].price}</span>
		                		<div class="mui-fright">
				        			<button type="button" class="mui-btn mui-btn-red">马上抢</button>
				        		</div>
		                	</div>
		                	<div class="mui-shop"><img src="img/6.png"/>通天自营</div>`;
					fragment.appendChild(li);
				}
				return fragment;
			}
		</script>
	</body>

</html>